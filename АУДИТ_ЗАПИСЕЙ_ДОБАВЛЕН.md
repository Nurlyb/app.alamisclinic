# ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π —Å –∑–∞–ø–∏—Å—è–º–∏

## üìã –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç, –∫—Ç–æ –∏ –∫–æ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω–∏–ª –¥–µ–π—Å—Ç–≤–∏—è —Å –∑–∞–ø–∏—Å—è–º–∏:
- –ö—Ç–æ —Å–æ–∑–¥–∞–ª –∑–∞–ø–∏—Å—å
- –ö—Ç–æ –æ—Ç–º–µ—Ç–∏–ª –ø—Ä–∏–±—ã—Ç–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- –ö—Ç–æ –æ—Ç–º–µ–Ω–∏–ª –∑–∞–ø–∏—Å—å
- –ö—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å –∑–∞–ø–∏—Å—å

## üóÑÔ∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü–µ Appointment

**–§–∞–π–ª:** `prisma/schema.prisma`

```prisma
model Appointment {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  
  managerId     String            // –ö—Ç–æ —Å–æ–∑–¥–∞–ª –∑–∞–ø–∏—Å—å (—É–∂–µ –±—ã–ª–æ)
  cancelledBy   String?           // ‚Üê –ù–æ–≤–æ–µ: –ö—Ç–æ –æ—Ç–º–µ–Ω–∏–ª –∑–∞–ø–∏—Å—å
  cancelledAt   DateTime?         // ‚Üê –ù–æ–≤–æ–µ: –ö–æ–≥–¥–∞ –æ—Ç–º–µ–Ω–∏–ª–∏
  transferredBy String?           // ‚Üê –ù–æ–≤–æ–µ: –ö—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å –∑–∞–ø–∏—Å—å
  transferredAt DateTime?         // ‚Üê –ù–æ–≤–æ–µ: –ö–æ–≥–¥–∞ –ø–µ—Ä–µ–Ω–µ—Å–ª–∏
  arrivedBy     String?           // ‚Üê –ù–æ–≤–æ–µ: –ö—Ç–æ –æ—Ç–º–µ—Ç–∏–ª –ø—Ä–∏–±—ã—Ç–∏–µ
  arrivedAt     DateTime?         // –í—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è (—É–∂–µ –±—ã–ª–æ)
  
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

### –ú–∏–≥—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è: `20260226193746_add_audit_fields_to_appointments`

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:
```bash
npx prisma migrate dev
```

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ API

### 1. –û—Ç–º–µ—Ç–∫–∞ –ø—Ä–∏–±—ã—Ç–∏—è
**–§–∞–π–ª:** `app/api/appointments/[id]/arrive/route.ts`

–¢–µ–ø–µ—Ä—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç `arrivedBy` (ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–º–µ—Ç–∏–ª –ø—Ä–∏–±—ã—Ç–∏–µ):

```typescript
const updatedAppointment = await prisma.appointment.update({
  where: { id },
  data: {
    status: 'ARRIVED',
    arrivedAt: new Date(),
    arrivedBy: user.userId, // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  },
  // ...
});
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ (–æ—Ç–º–µ–Ω–∞/–ø–µ—Ä–µ–Ω–æ—Å)
**–§–∞–π–ª:** `app/api/appointments/[id]/route.ts`

–¢–µ–ø–µ—Ä—å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–µ–π—Å—Ç–≤–∏—è:

```typescript
// –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ
if (data.status === 'CANCELLED') {
  updateData.cancelledBy = user.userId;
  updateData.cancelledAt = new Date();
}

// –ü—Ä–∏ –ø–µ—Ä–µ–Ω–æ—Å–µ
if (data.status === 'TRANSFERRED') {
  updateData.transferredBy = user.userId;
  updateData.transferredAt = new Date();
}
```

### 3. –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏
**–§–∞–π–ª:** `app/api/appointments/[id]/route.ts`

–ü—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Å—Ç–∞—Ç—É—Å CANCELLED):

```typescript
const cancelledAppointment = await prisma.appointment.update({
  where: { id },
  data: { 
    status: 'CANCELLED',
    cancelledBy: user.userId,    // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
    cancelledAt: new Date(),     // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  },
});
```

## üé® –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

### –î–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
**–§–∞–π–ª:** `app/schedule/page.tsx`

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è "–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π" (–≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü—É):

```tsx
{user?.role === 'OWNER' && (
  <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg">
    <label className="text-sm font-medium text-blue-900 mb-2 block">
      üìã –ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π
    </label>
    <div className="space-y-2 text-xs text-blue-800">
      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ */}
      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–±—ã—Ç–∏–∏ */}
      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—Ç–º–µ–Ω–µ */}
      {/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–µ—Ä–µ–Ω–æ—Å–µ */}
    </div>
  </div>
)}
```

### –û—Ç–æ–±—Ä–∞–∂–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:

1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏**
   - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è
   - –ö—Ç–æ —Å–æ–∑–¥–∞–ª (–∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

2. **–ü—Ä–∏–±—ã—Ç–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞**
   - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø—Ä–∏–±—ã—Ç–∏—è
   - –ö—Ç–æ –æ—Ç–º–µ—Ç–∏–ª –ø—Ä–∏–±—ã—Ç–∏–µ

3. **–û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏**
   - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –æ—Ç–º–µ–Ω—ã
   - –ö—Ç–æ –æ—Ç–º–µ–Ω–∏–ª

4. **–ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏**
   - –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–µ—Ä–µ–Ω–æ—Å–∞
   - –ö—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å

## üìä –¢–∏–ø—ã TypeScript

**–§–∞–π–ª:** `types/index.ts`

–û–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Appointment:

```typescript
export interface Appointment {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
  
  arrivedBy?: string;      // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  cancelledAt?: string;    // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  cancelledBy?: string;    // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  transferredAt?: string;  // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  transferredBy?: string;  // ‚Üê –î–æ–±–∞–≤–ª–µ–Ω–æ
  
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
}
```

## üëÅÔ∏è –ö—Ç–æ –≤–∏–¥–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∞—É–¥–∏—Ç–µ

| –†–æ–ª—å | –í–∏–¥–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–µ–π—Å—Ç–≤–∏–π |
|------|------------------------|
| –í–ª–∞–¥–µ–ª–µ—Ü | ‚úÖ –î–∞, –ø–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è |
| –û–ø–µ—Ä–∞—Ç–æ—Ä | ‚ùå –ù–µ—Ç |
| –†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞ | ‚ùå –ù–µ—Ç |
| –î–æ–∫—Ç–æ—Ä | ‚ùå –ù–µ—Ç |
| –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç | ‚ùå –ù–µ—Ç |

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
```
–°–æ–∑–¥–∞–Ω–æ: 27.02.2026 10:30
–°–æ–∑–¥–∞–ª: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω (–û–ø–µ—Ä–∞—Ç–æ—Ä)
```

### –ü—Ä–∏–º–µ—Ä 2: –û—Ç–º–µ—Ç–∫–∞ –ø—Ä–∏–±—ã—Ç–∏—è
```
–°–æ–∑–¥–∞–Ω–æ: 27.02.2026 10:30
–°–æ–∑–¥–∞–ª: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω (–û–ø–µ—Ä–∞—Ç–æ—Ä)

–ü—Ä–∏–±—ã–ª: 27.02.2026 14:25
–û—Ç–º–µ—Ç–∏–ª –ø—Ä–∏–±—ã—Ç–∏–µ: –ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è (–†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞)
```

### –ü—Ä–∏–º–µ—Ä 3: –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏
```
–°–æ–∑–¥–∞–Ω–æ: 27.02.2026 10:30
–°–æ–∑–¥–∞–ª: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω (–û–ø–µ—Ä–∞—Ç–æ—Ä)

–û—Ç–º–µ–Ω–µ–Ω–æ: 27.02.2026 12:15
–û—Ç–º–µ–Ω–∏–ª: –°–∏–¥–æ—Ä–æ–≤–∞ –ê–Ω–Ω–∞ (–†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞)
```

### –ü—Ä–∏–º–µ—Ä 4: –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏
```
–°–æ–∑–¥–∞–Ω–æ: 27.02.2026 10:30
–°–æ–∑–¥–∞–ª: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω (–û–ø–µ—Ä–∞—Ç–æ—Ä)

–ü–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ: 27.02.2026 13:45
–ü–µ—Ä–µ–Ω–µ—Å: –ü–µ—Ç—Ä–æ–≤–∞ –ú–∞—Ä–∏—è (–†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞)
```

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞—É–¥–∏—Ç

–ü–æ–º–∏–º–æ —ç—Ç–∏—Ö –ø–æ–ª–µ–π, –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Ç–∞–∫–∂–µ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `AuditLog`:
- –ü–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –°—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- IP –∞–¥—Ä–µ—Å–∞
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏

–í–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø–æ–ª–Ω—ã–π –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ñ—É—Ä–Ω–∞–ª –¥–µ–π—Å—Ç–≤–∏–π".

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –®–∞–≥–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

1. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –≤–ª–∞–¥–µ–ª–µ—Ü** (+77001234567)
2. –û—Ç–∫—Ä–æ–π—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
3. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å (–∫–∞–∫ –æ–ø–µ—Ä–∞—Ç–æ—Ä)
4. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–µ—Ç–∞–ª–∏ –∑–∞–ø–∏—Å–∏
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ–∫—Ü–∏—é "–ò—Å—Ç–æ—Ä–∏—è –¥–µ–π—Å—Ç–≤–∏–π"
6. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è:
   - –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
   - –ö—Ç–æ —Å–æ–∑–¥–∞–ª

7. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞** (+77001234569)
8. –û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∏–±—ã—Ç–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
9. **–í–æ–π–¥–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ –∫–∞–∫ –≤–ª–∞–¥–µ–ª–µ—Ü**
10. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç—É –∂–µ –∑–∞–ø–∏—Å—å
11. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–∞—Å—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∏–±—ã—Ç–∏–∏

12. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∏ –ø–µ—Ä–µ–Ω–æ—Å–∞

## üì¶ –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

1. `prisma/schema.prisma` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –∞—É–¥–∏—Ç–∞
2. `app/api/appointments/[id]/arrive/route.ts` - –∑–∞–ø–∏—Å—å arrivedBy
3. `app/api/appointments/[id]/route.ts` - –∑–∞–ø–∏—Å—å cancelledBy/transferredBy
4. `app/schedule/page.tsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
5. `types/index.ts` - –æ–±–Ω–æ–≤–ª–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Appointment

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–º–µ—Å—Ç–æ ID (—Å–µ–π—á–∞—Å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è ID)
- –≠–∫—Å–ø–æ—Ä—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ Excel/PDF
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤ –∂—É—Ä–Ω–∞–ª–µ –∞—É–¥–∏—Ç–∞
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É –æ –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏—è—Ö

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
**–î–∞—Ç–∞:** 2026-02-27
**–ú–∏–≥—Ä–∞—Ü–∏—è:** –ü—Ä–∏–º–µ–Ω–µ–Ω–∞
